#!/bin/sh
echo ---------- INSTALLING PREREQUISITES ----------
cd /root
yum install -y nodejs
yum install -y npm
yum install -y git
yum install -y ImageMagick
curl https://install.meteor.com | /bin/sh
npm install express
npm install mongodb
npm install mongo-fast-join
yum install -y mongodb
yum install -y mongodb-server
echo ---------- SETUP MONGOD AUTOSTART ----------
chkconfig mongod on
echo -------------- SETUP FIREWALL --------------
iptables -I INPUT 4 -p tcp -m tcp --dport 80 -j ACCEPT
iptables -I INPUT 4 -p tcp -m tcp --dport 27017 -j ACCEPT
iptables -I INPUT 4 -p tcp --match multiport --dports 3000:4000 -j ACCEPT
/etc/init.d/iptables save
mkdir react001
cd react001
echo --------------- CLONING 1st ------------------------------------
git clone -b development https://github.com/reactioncommerce/reaction
cd reaction && git checkout master
echo --------------CLONING REACTION-CORE DEVELOPMENT----------------
cd packages
git clone -b development https://github.com/reactioncommerce/reaction-core.git
echo --------------VALIDATE EMPORYOU.COM TO LOAD JS ---------------
git clone https://github.com/emporyou/reaction2emporyou.git
cd ..
meteor add reactioncommerce:reaction2emporyou
echo -------------- STARTING 1st ------------- AND WAITING 2 MINUTES
meteor run --port 3010 > started1.txt &
cd ../..
sleep 2m
echo --------------- CLONING FRONTEND ------------------------------
git clone https://github.com/emporyou/emporyou.git
echo  -------------- SETUP REBOOT SCRIPT ---------------------------
cp emporyou/emporyou /etc/init.d/
chmod 755 /etc/init.d/emporyou
chkconfig emporyou on
echo  --------------- STARTING FRONTEND ----------------------------
cd emporyou
node frontend/app.js &
cd /root
echo  --------------- GREP CREDENTIALS -----------------------------
echo CREDENTIALS 1
grep "EMAIL/LOGIN:" react001/reaction/started1.txt
grep "PASSWORD:" react001/reaction/started1.txt
echo REBOOTING in 10sec press CTRL+C to abort
sleep 10s
reboot
