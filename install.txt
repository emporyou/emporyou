#!/bin/sh
echo ---------- INSTALLING PREREQUISITES ----------
cd /root
yum install -y nodejs
yum install -y npm
yum install -y git
yum install -y ImageMagick
curl https://install.meteor.com | /bin/sh
npm install express
npm install mongodb
npm install mongo-fast-join
yum install -y mongodb
yum install -y mongodb-server
echo ---------- SETUP MONGOD AUTOSTART ----------
chkconfig mongod on
echo -------------- SETUP FIREWALL --------------
iptables -I INPUT 4 -p tcp -m tcp --dport 80 -j ACCEPT
iptables -I INPUT 4 -p tcp -m tcp --dport 27017 -j ACCEPT
iptables -I INPUT 4 -p tcp --match multiport --dports 3000:4000 -j ACCEPT
/etc/init.d/iptables save

mkdir react001
cd react001
echo --------------- CLONING 1st ------------------------------------
git clone -b development https://github.com/reactioncommerce/reaction
cd reaction && git checkout master
echo -------------- STARTING 1st ------------- AND WAITING 2 MINUTES
meteor run --port 3010 > started1.txt &
cd ../..
sleep 2m
mkdir react002
cd react002
echo --------------- CLONING 2nd ------------------------------------
git clone https://github.com/reactioncommerce/reaction
cd reaction && git checkout master
echo -------------- STARTING 2nd ------------- AND WAITING 60 SECONDS
meteor run --port 3020 > started2.txt &
cd ../..
sleep 60s
mkdir react003
cd react003
echo --------------- CLONING 3rd ------------------------------------
git clone https://github.com/reactioncommerce/reaction
cd reaction && git checkout master
echo -------------- STARTING 3rd ------------- AND WAITING 60 SECONDS
meteor run --port 3030 > started3.txt &
cd ../..
sleep 60s
mkdir react004
cd react004
echo --------------- CLONING 4th ------------------------------------
git clone https://github.com/reactioncommerce/reaction
cd reaction && git checkout master
echo -------------- STARTING 4th ------------- AND WAITING 60 SECONDS
meteor run --port 3040 > started4.txt &
cd ../..
sleep 60s
mkdir react005
cd react005
echo --------------- CLONING 5th ------------------------------------
git clone https://github.com/reactioncommerce/reaction
cd reaction && git checkout master
echo -------------- STARTING 5th ------------- AND WAITING 60 SECONDS
meteor run --port 3050 > started5.txt &
cd ../..
sleep 60s
echo --------------- CLONING FRONTEND ------------------------------
git clone https://github.com/officinetesla/emporyou.git
echo  -------------- SETUP REBOOT SCRIPT ---------------------------
cp emporyou/emporyou /etc/init.d/
chmod 755 /etc/init.d/emporyou
chkconfig emporyou on
echo  --------------- STARTING FRONTEND ----------------------------
cd emporyou
node frontend/app.js &
cd /root
echo --------------CLONING REACTION-CORE DEVELOPMENT----------------
cd react001/reaction/packages
git clone -b development https://github.com/reactioncommerce/reaction-core.git
cd ../../..
cd react002/reaction/packages
git clone -b development https://github.com/reactioncommerce/reaction-core.git
cd ../../..
cd react003/reaction/packages
git clone -b development https://github.com/reactioncommerce/reaction-core.git
cd ../../..
cd react004/reaction/packages
git clone -b development https://github.com/reactioncommerce/reaction-core.git
cd ../../..
cd react005/reaction/packages
git clone -b development https://github.com/reactioncommerce/reaction-core.git
cd ../../..
echo  --------------- GREP CREDENTIALS -----------------------------
echo CREDENTIALS 1
grep "EMAIL/LOGIN:" react001/reaction/started1.txt
grep "PASSWORD:" react001/reaction/started1.txt
echo CREDENTIALS 2
grep "EMAIL/LOGIN:" react002/reaction/started2.txt
grep "PASSWORD:" react002/reaction/started2.txt
echo CREDENTIALS 3
grep "EMAIL/LOGIN:" react003/reaction/started3.txt
grep "PASSWORD:" react003/reaction/started3.txt
echo CREDENTIALS 4
grep "EMAIL/LOGIN:" react004/reaction/started4.txt
grep "PASSWORD:" react004/reaction/started4.txt
echo CREDENTIALS 5
grep "EMAIL/LOGIN:" react005/reaction/started5.txt
grep "PASSWORD:" react005/reaction/started5.txt
echo REBOOTING in 10sec press CTRL+C to abort
sleep 10s
reboot
